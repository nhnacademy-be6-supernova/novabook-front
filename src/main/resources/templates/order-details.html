<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NovaBookğŸ“•</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700|Raleway:400,300,500,700,600'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css"
          type="text/css">
    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <style>
        .form-inline .form-group {
            display: flex;
            align-items: center;
        }

        .form-inline .form-group input[type="text"] {
            flex: 1;
        }

        .delivery-date-container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .delivery-date-header {
            margin-bottom: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
            background-color: #f5f5f5;
        }

        .delivery-date-row {
            display: flex;
            justify-content: space-between;
            background-color: #f5f5f5;
        }

        .delivery-date-btn {
            flex: 1;
            text-align: center;
            border: 1px solid #ddd;
            padding: 10px;
            cursor: pointer;
            margin-right: 5px;
            background-color: #fff;
        }

        .delivery-date-btn.selected {
            background-color: #337ab7;
            color: white;
        }

        .delivery-date-btn:last-child {
            margin-right: 0;
        }

        .btn-center {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .payment-info {
            margin-top: 20px;
        }

        .payment-info-table {
            width: 100%;
            margin-top: 20px;
        }

        .payment-info-table th, .payment-info-table td {
            text-align: center;
            padding: 10px;
        }

        .payment-info-table .total {
            font-size: 1.5em;
            color: #d9534f;
        }

        .form-group-inline {
            display: inline-block;
            margin-right: 10px;
        }

        .full-width {
            width: 100%;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .section-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
        }

        .section {
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff;
            border: 0; /* ë³´ë”ê°’ì„ 0ìœ¼ë¡œ ì„¤ì • */
        }
    </style>
</head>

<body>
<div th:replace="~{layout/nav::nav}"></div>
<div class="layout">

    <div class="container">
        <h1>ì£¼ë¬¸ í™•ì¸</h1>
        <form th:action="@{/order/success}" method="post">
            <!-- ì£¼ë¬¸ ìš”ì•½ -->
            <div class="section">
                <h2 class="section-header">ì£¼ë¬¸ ìš”ì•½</h2>
                <table class="table">
                    <thead>
                    <tr>
                        <th>ìƒí’ˆëª…</th>
                        <th>ê°€ê²©</th>
                        <th>ìˆ˜ëŸ‰</th>
                        <th>í• ì¸</th>
                        <th>í•©ê³„</th>
                        <!--                        <th>ë°°ì†¡ ë‚ ì§œ</th>-->
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="item, iterStat : ${items}">
                        <td th:text="${item.name}">Product Name</td>
                        <td th:text="${item.price}">14,800ì›</td>
                        <td th:text="${item.quantity}">1</td>
                        <td th:text="${item.discount}">10%</td>
                        <td th:text="${item.total}">13,320ì›</td>
                        <!--                        <td>ë‚´ì¼ (6/15)</td>-->
                    </tr>
                    <tr th:if="${items == null || #lists.isEmpty(items)}">
                        <td colspan="6">ì£¼ë¬¸í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- í¬ì¥ ì˜µì…˜ -->
            <div class="section">
                <h2 class="section-header">í¬ì¥ ì˜µì…˜</h2>
                <select name="packaging" class="form-control" onchange="updatePackagingPrice(this)">
                    <option value="standard" data-price="0">ì¼ë°˜ í¬ì¥</option>
                    <option value="gift" data-price="3000">ì„ ë¬¼ í¬ì¥ (+3,000ì›)</option>
                    <option value="eco" data-price="1000">ì¹œí™˜ê²½ í¬ì¥ (+1,000ì›)</option>
                </select>
            </div>

            <!-- ì¿ í° ì ìš© -->
            <div class="section">
                <h2 class="section-header">ì¿ í° ì ìš©</h2>
                <div class="form-group form-group-inline">
                    <input type="text" name="coupon" class="form-control" placeholder="ì¿ í° ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”"/>
                </div>
                <button type="button" class="btn btn-primary" onclick="applyCoupon()">ì¿ í° ì ìš©</button>
            </div>

            <!-- í¬ì¸íŠ¸ ì‚¬ìš© -->
            <div class="section">
                <h2 class="section-header">í¬ì¸íŠ¸ ì‚¬ìš©</h2>
                <div class="form-group full-width">
                    <label for="currentPoints">í˜„ì¬ í¬ì¸íŠ¸: </label>
                    <span id="currentPoints" style="margin-left: 10px;">5,000í¬ì¸íŠ¸</span>
                </div>
                <div class="form-group full-width" style="display: flex; align-items: center;">
                    <input type="text" name="points" id="pointsInput" class="form-control" style="width: 20%;" placeholder="ì‚¬ìš©í•  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
                    <button type="button" class="btn btn-primary" style="margin-left: 10px;" onclick="applyPoints()">í¬ì¸íŠ¸ ì ìš©</button>
                </div>
            </div>

            <!-- ë°°ì†¡ì¼ ì„ íƒ -->
            <div class="section delivery-date-container" style="background-color: #f5f5f5; border: 1px solid #ddd;">
                <h4 class="delivery-date-header">ë°°ì†¡ì¼ ì„ íƒ (ë„ì°© ì˜ˆìƒì¼)</h4>
                <div class="delivery-date-row">
                    <div class="delivery-date-btn" onclick="selectDeliveryDate(this)">ì˜¤ëŠ˜ (6/14)</div>
                    <div class="delivery-date-btn selected" onclick="selectDeliveryDate(this)">ë‚´ì¼ (6/15)</div>
                    <div class="delivery-date-btn" onclick="selectDeliveryDate(this)">ì›” (6/17)</div>
                    <div class="delivery-date-btn" onclick="selectDeliveryDate(this)">í™” (6/18)</div>
                    <div class="delivery-date-btn" onclick="selectDeliveryDate(this)">ìˆ˜ (6/19)</div>
                    <div class="delivery-date-btn" onclick="selectDeliveryDate(this)">ëª© (6/20)</div>
                </div>
            </div>

            <!-- ë°°ì†¡ì§€ ì •ë³´ -->
            <div class="section">
                <h2 class="section-header">ë°°ì†¡ì§€ ì •ë³´</h2>
                <div class="form-group full-width">
                    <label for="name">ì´ë¦„</label>
                    <input type="text" id="name" name="name" class="form-control" style="width: 70%;" value="í™ê¸¸ë™" placeholder="ì´ë¦„" />
                </div>
                <div class="form-group full-width" style="align-items: center;">
                    <label for="address">ì£¼ì†Œ</label>
                    <div style="display: flex">
                        <input type="text" id="address" name="address" class="form-control" style=" width: 70%;" value="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬" placeholder="ì£¼ì†Œ" />
                        <button type="button" class="btn btn-info" style="margin-left: 10px;" onclick="openAddressBook()">ì£¼ì†Œë¡</button>
                    </div>
                </div>
                <div class="form-group full-width">
                    <label for="phone">ì „í™”ë²ˆí˜¸</label>
                    <input type="text" id="phone" name="phone" class="form-control" style="width: 70%;" value="010-1234-5678" placeholder="ì „í™”ë²ˆí˜¸" />
                </div>
                <div class="form-group full-width">
                    <label for="email">ì´ë©”ì¼</label>
                    <input type="email" id="email" name="email" class="form-control" style="width: 70%;" value="example@example.com" placeholder="ì´ë©”ì¼" />
                </div>
            </div>

            <!-- ê²°ì œ ì •ë³´ -->
            <div class="section payment-info">
                <h2 class="section-header" style="border-bottom: 0; margin-bottom: 0;">ê²°ì œ ì •ë³´</h2>
                <div class="table-responsive">
                    <table class="table payment-info-table">
                        <thead>
                        <tr>
                            <th>ì´ ìƒí’ˆê¸ˆì•¡</th>
                            <th>ì´ ì¶”ê°€ê¸ˆì•¡</th>
                            <th>ì´ í• ì¸ê¸ˆì•¡</th>
                            <th>ì´ í¬ì¸íŠ¸ ì‚¬ìš©</th>
                            <th>ë°°ì†¡ë¹„</th>
                            <th>ìµœì¢… ê²°ì œê¸ˆì•¡</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td id="totalAmount">31,320ì›</td>
                            <td id="additionalAmount">0ì›</td>
                            <td id="discountAmount">0ì›</td>
                            <td id="pointsUsed">0ì›</td>
                            <td id="shippingFee">2,500ì›</td> <!-- ì¶”ê°€ëœ ë°°ì†¡ë¹„ ë¶€ë¶„ -->
                            <td class="total" id="finalAmount">33,820ì›</td> <!-- ìµœì¢… ê²°ì œê¸ˆì•¡ì— ë°°ì†¡ë¹„ë¥¼ ë°˜ì˜ -->
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ì£¼ë¬¸ í™•ì¸ ë²„íŠ¼ -->
            <div class="btn-center">
                <button type="submit" class="btn btn-primary">ì£¼ë¬¸ í™•ì¸</button>
            </div>
        </form>
    </div>

    <!-- ì£¼ì†Œë¡ ëª¨ë‹¬ -->
    <div id="addressBookModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">ì£¼ì†Œë¡</h4>
                </div>
                <div class="modal-body">
                    <ul>
                        <li><a href="#" onclick="selectAddress('ì„œìš¸ì‹œ ì¢…ë¡œêµ¬', '010-9876-5432')">ì„œìš¸ì‹œ ì¢…ë¡œêµ¬</a></li>
                        <li><a href="#" onclick="selectAddress('ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬', '010-6543-2109')">ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬</a></li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script>
        function applyCoupon() {
            alert("ì¿ í°ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!");
            // ì‹¤ì œ ì ìš© ë¡œì§ í•„ìš”
            // ì˜ˆ: í• ì¸ ê¸ˆì•¡ ì—…ë°ì´íŠ¸, ìµœì¢… ê²°ì œ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
            $('#discountAmount').text("5,000ì›"); // ì˜ˆì‹œë¡œ 5,000ì› í• ì¸
            updateFinalAmount();
        }

        function applyPoints() {
            const currentPoints = parseInt($('#currentPoints').text().replace('í¬ì¸íŠ¸', '').replace(',', ''), 10);
            const pointsInput = parseInt($('#pointsInput').val(), 10);

            if (pointsInput > currentPoints) {
                alert("ì‚¬ìš©í•  í¬ì¸íŠ¸ëŠ” í˜„ì¬ í¬ì¸íŠ¸ë³´ë‹¤ ë§ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            alert("í¬ì¸íŠ¸ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!");
            // ì‹¤ì œ ì ìš© ë¡œì§ í•„ìš”
            // ì˜ˆ: í¬ì¸íŠ¸ ê¸ˆì•¡ ì—…ë°ì´íŠ¸, ìµœì¢… ê²°ì œ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
            $('#pointsUsed').text(pointsInput + "ì›"); // ì…ë ¥ëœ í¬ì¸íŠ¸ ì‚¬ìš©
            updateFinalAmount();
        }

        function openAddressBook() {
            $('#addressBookModal').modal('show');
        }

        function selectAddress(address, phone) {
            $('#address').val(address);
            $('#phone').val(phone);
            $('#addressBookModal').modal('hide');
        }

        function updatePackagingPrice(selectElement) {
            const price = parseInt($(selectElement).find('option:selected').data('price'), 10);
            $('#additionalAmount').text(price + "ì›");
            updateFinalAmount();
        }

        function updateFinalAmount() {
            const totalAmount = parseInt($('#totalAmount').text().replace('ì›', '').replace(',', ''), 10);
            const additionalAmount = parseInt($('#additionalAmount').text().replace('ì›', '').replace(',', ''), 10);
            const discountAmount = parseInt($('#discountAmount').text().replace('ì›', '').replace(',', ''), 10);
            const pointsUsed = parseInt($('#pointsUsed').text().replace('ì›', '').replace(',', ''), 10);
            const shippingFee = parseInt($('#shippingFee').text().replace('ì›', '').replace(',', ''), 10);
            const finalAmount = totalAmount + additionalAmount - discountAmount - pointsUsed + shippingFee;
            $('#finalAmount').text(finalAmount.toLocaleString() + "ì›");
        }

        function selectDeliveryDate(element) {
            $('.delivery-date-btn').removeClass('selected');
            $(element).addClass('selected');
        }
    </script>
</div>
<div th:replace="~{layout/footer::footer}"></div>
</body>
</html>
