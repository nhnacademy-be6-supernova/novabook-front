<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="#{book.list.title}+'ğŸ“•'">ì±… ê²€ìƒ‰ ê²°ê³¼</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700|Raleway:400,300,500,700,600'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css"
          type="text/css">
    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <style>
        .table-striped tbody tr td,
        .table-striped tbody tr th {
            border-right: 1px solid #ddd;
            vertical-align: middle;
            text-align: center;
        }
        .table-striped thead th {
            text-align: center;
            vertical-align: middle;
        }
        .table-striped tbody tr td:last-child,
        .table-striped tbody tr th:last-child {
            border-right: none;
        }

        .table-striped tbody tr td .btn-group-vertical {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .table-striped tbody tr td img {
            display: block;
            margin: 0 auto;
        }

        .table-striped tbody tr td .star-rating,
        .table-striped tbody tr td .packaging-status {
            font-size: 14px;
            line-height: 1.2;
        }

        .book-info {
            display: flex;
            flex-direction: column;
        }

        .book-title {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .book-author-publisher {
            font-size: 0.875rem;
            color: #555;
        }

        .book-author,
        .book-publisher {
            font-size: 1rem;
        }

        .price-info {
            display: flex;
            flex-direction: column;
        }

        .original-price {
            font-size: 0.875rem;
            color: #999;
            text-decoration: line-through;
        }

        .discounted-price {
            font-size: 1.25rem;
            color: #d9534f;
            font-weight: bold;
        }

        .category-tag {
            font-size: 1rem;
            color: #555;
        }
    </style>
</head>

<body>
<div th:replace="~{layout/store/nav::nav}"></div>

<div class="layout">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="sort-options well">
                    <div class="pull-left">
                        <label th:text="#{book.list.sortBy}">ì •ë ¬ ê¸°ì¤€:</label>
                        <a id="lowest_price" href="#" th:text="#{sortOption.lowestPrice}">ìµœì €ê°€</a> |
                        <a id="rating" href="#" th:text="#{sortOption.rating}">í‰ì </a> |
                        <a id="review" href="#" th:text="#{sortOption.review}">ë¦¬ë·° ìˆœ</a>
                    </div>
                    <div class="pull-right">
                        <label for="itemsPerPage" class="control-label" th:text="#{book.list.itemsPerPage}">í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜:</label>
                        <select id="itemsPerPage" class="form-control" style="display:inline-block; width:auto;">
                            <option value="10">10ê°œ</option>
                            <option value="20">20ê°œ</option>
                            <option value="50">50ê°œ</option>
                        </select>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>

            <!-- ì±… ê²€ìƒ‰ ê²°ê³¼ ì„¹ì…˜ -->
            <div class="col-md-12">
                <form id="searchResultsForm">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th th:text="#{book.list.cover}">ì±… í‘œì§€</th>
                            <th th:text="#{book.list.info}">ì±… ì •ë³´</th>
                            <th th:text="#{book.list.rating}">ë³„ì </th>
                            <th th:text="#{book.list.price}">ê°€ê²©</th>
                            <th th:text="#{book.list.packaging}">í¬ì¥ ì—¬ë¶€</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- ì±… ëª©ë¡ ë°˜ë³µë¬¸ -->
                        <tr th:each="book : ${bookSearches.data}">
                            <td><img th:src="@{${book.image}}" alt="ì±… ì‚¬ì§„" style="width:100px;"></td>
                            <td>
                                <div class="book-info">
                                    <a class="book-title" th:href="@{/books/book/{id}(id=${book.id})}" th:text="${book.title}">ì±… ì œëª©</a>
                                    <div class="book-author-publisher">
                                        <span class="book-author" th:text="${book.author}">ì €ì</span><br>
                                        <span class="book-publisher" th:text="${book.publisher}">ì¶œíŒì‚¬</span>
                                    </div>
                                </div>
                            </td>
                            <td class="star-rating">
                                <span th:text="${book.score}">ë³„ì </span>
                                <span class="fa fa-star" style="color:#ffd11a;"></span>
                            </td>
                            <td>
                                <div class="price-info">
                                    <span class="original-price" th:text="${book.price} + ' ì›'">íŒë§¤ ê°€ê²©</span>
                                    <span class="discounted-price" th:text="${book.discountPrice} + ' ì›'">í• ì¸ ê°€ê²©</span>
                                </div>
                            </td>
                            <td>
                                <span style="font-size: 16px;" class="strong-text" th:if="${book.isPackaged}">í¬ì¥ ê°€ëŠ¥</span>
                                <span style="font-size: 16px;" class="strong-text" th:if="${!book.isPackaged}">í¬ì¥ ë¶ˆê°€</span>
                            </td>
                            <td>
                                <div class="btn-group-vertical">
                                    <a href="#" class="btn btn-primary" th:text="#{book.list.addToCart}">ì¥ë°”êµ¬ë‹ˆì— ë„£ê¸°</a>
                                    <a href="#" class="btn btn-success" th:text="#{book.list.buyNow}">ë°”ë¡œ êµ¬ë§¤</a>
                                    <a th:href="@{/books/book/{id}(id=${book.id})}" class="btn btn-info" th:text="#{book.list.viewProduct}">ìƒí’ˆ ë³´ê¸°</a>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </form>

                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="pagination">
                    <!-- ì´ì „ ë²„íŠ¼ -->
                    <li class="page-item" th:classappend="${bookSearches.pageNum == 0} ? 'disabled'">
                        <a th:if="${bookSearches.pageNum > 0}" th:href="@{${prevPageUrl}}" onclick="return false;" th:text="#{pagination.previous}">Previous</a>
                        <span th:if="${bookSearches.pageNum == 0}" th:text="#{pagination.previous}">Previous</span>
                    </li>

                    <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
                    <li class="page-item" th:if="${bookSearches.getTotalPageCount() > 0}" th:each="i : ${#numbers.sequence(0, bookSearches.getTotalPageCount() - 1)}">
                        <a th:href="@{${currentPageUrl}}" th:text="${i + 1}" th:classappend="${i == bookSearches.pageNum} ? 'active' : ''"></a>
                    </li>

                    <!-- ë‹¤ìŒ ë²„íŠ¼ -->
                    <li class="page-item" th:classappend="${bookSearches.pageNum >= bookSearches.getTotalPageCount() - 1} ? 'disabled'">
                        <a th:if="${bookSearches.pageNum < bookSearches.getTotalPageCount() - 1}" th:href="@{${nextPageUrl}}" onclick="return false;" th:text="#{pagination.next}">Next</a>
                        <span th:if="${bookSearches.pageNum >= bookSearches.getTotalPageCount() - 1}" th:text="#{pagination.next}">Next</span>
                    </li>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{layout/store/footer::footer}"></div>

<!-- Hidden Inputs -->
<input type="hidden" id="searchType" th:value="${searchType}">
<input type="hidden" id="keyword" th:value="${keyword}">
<input type="hidden" id="pageNum" th:value="${bookSearches.pageNum}">
<!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        var searchType = $('#searchType').val();
        var keyword = $('#keyword').val();
        var pageNum = $('#pageNum').val();

        var prevPageUrl = createPaginationLink(searchType, keyword, parseInt(pageNum) - 1);
        var nextPageUrl = createPaginationLink(searchType, keyword, parseInt(pageNum) + 1);
        var currentPageUrl = createPaginationLink(searchType, keyword, pageNum);


        // ì´ì „ í˜ì´ì§€ ë§í¬ ì„¤ì •
        $('.pagination .page-item:first-child a').attr('href', prevPageUrl);

        // ë‹¤ìŒ í˜ì´ì§€ ë§í¬ ì„¤ì •
        $('.pagination .page-item:last-child a').attr('href', nextPageUrl);

        // ê° í˜ì´ì§€ ë²ˆí˜¸ ë§í¬ ì„¤ì •
        $('.pagination .page-item:not(:first-child):not(:last-child) a').each(function(index) {
            $(this).attr('href', createPaginationLink(searchType, keyword, index));

        });

        // ì •ë ¬ ê¸°ì¤€ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        // $('#lowest_price').on('click', function() {
        //     var sortLink = createSortLink(searchType, keyword, 'discountPrice');
        //     window.location.href = sortLink;
        // });
        //
        // $('#highest_price').on('click', function() {
        //     var sortLink = createSortLink(searchType, keyword, 'discountPrice');
        //     window.location.href = sortLink;
        // });

        $('#lowest_price').on('click', function() {
            var sortLink = createSortLink(searchType, keyword, 'discountPrice');
            window.location.href = sortLink;
        });

        $('#rating').on('click', function() {
            var sortLink = createSortLink(searchType, keyword, 'score');
            window.location.href = sortLink;
        });

        $('#review').on('click', function() {
            var sortLink = createSortLink(searchType, keyword, 'review');
            window.location.href = sortLink;
        });



        // ì„ íƒëœ ëª¨ë“  ì±… ì²´í¬ë°•ìŠ¤
        $('#selectAll').on('click', function () {
            $('.bookCheckbox').prop('checked', this.checked);
        });

        // ì„ íƒëœ í•­ëª© ì¥ë°”êµ¬ë‹ˆì— ë„£ê¸° ë° ë°”ë¡œ êµ¬ë§¤
        $('#searchResultsForm').on('submit', function (e) {
            e.preventDefault();
            // ì„ íƒëœ ì±… ì•„ì´í…œë“¤ì— ëŒ€í•œ ì²˜ë¦¬ ë¡œì§ì„ ì—¬ê¸°ì— ì¶”ê°€í•˜ì„¸ìš”.
            alert('ì„ íƒëœ í•­ëª©ì´ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });
    });


    function createSortLink(searchType, keyword, sortType) {
        if (searchType === 'category') {
            return '/search/category?category=' + keyword + '&sort=' + sortType;
        } else if (searchType === 'keyword') {
            return '/search/keyword?keyword=' + keyword + '&sort=' + sortType;
        } else {
            return '#';
        }
    }
    function createPaginationLink(searchType, keyword, pageNum) {
        if (searchType === 'category') {
            return '/search/category?category=' + keyword + '&page=' + pageNum;
        } else if (searchType === 'keyword') {
            return '/search/keyword?keyword=' + keyword + '&page=' + pageNum;
        } else {
            return '#';
        }
    }

</script>
</body>
</html>
