<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="#{book.list.title}+'üìï'">Ï±Ö Í≤ÄÏÉâ Í≤∞Í≥º</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700|Raleway:400,300,500,700,600'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css"
          type="text/css">
    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <style>
        .table-striped tbody tr td,
        .table-striped tbody tr th {
            border-right: 1px solid #ddd;
            vertical-align: middle;
            text-align: center;
        }
        .table-striped thead th {
            text-align: center;
            vertical-align: middle;
        }
        .table-striped tbody tr td:last-child,
        .table-striped tbody tr th:last-child {
            border-right: none;
        }

        .table-striped tbody tr td .btn-group-vertical {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .table-striped tbody tr td img {
            display: block;
            margin: 0 auto;
        }

        .table-striped tbody tr td .star-rating,
        .table-striped tbody tr td .packaging-status {
            font-size: 14px;
            line-height: 1.2;
        }

        .book-info {
            display: flex;
            flex-direction: column;
        }

        .book-title {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .book-author-publisher {
            font-size: 0.875rem;
            color: #555;
        }

        .book-author,
        .book-publisher {
            font-size: 1rem;
        }

        .price-info {
            display: flex;
            flex-direction: column;
        }

        .original-price {
            font-size: 0.875rem;
            color: #999;
            text-decoration: line-through;
        }

        .discounted-price {
            font-size: 1.25rem;
            color: #d9534f;
            font-weight: bold;
        }

        .category-tag {
            font-size: 1rem;
            color: #555;
        }
    </style>
</head>

<body>
<div th:replace="~{layout/store/nav::nav}"></div>

<div class="layout">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="sort-options well">
                    <div class="pull-left">
                        <label th:text="#{book.list.sortBy}">Ï†ïÎ†¨ Í∏∞Ï§Ä:</label>
                        <a id="lowest_price" href="#" th:text="#{sortOption.lowestPrice}">ÏµúÏ†ÄÍ∞Ä</a> |
                        <a id="rating" href="#" th:text="#{sortOption.rating}">ÌèâÏ†ê</a> |
                        <a id="review" href="#" th:text="#{sortOption.review}">Î¶¨Î∑∞ Ïàú</a>
                    </div>
                    <div class="pull-right">
                        <label for="itemsPerPage" class="control-label" th:text="#{book.list.itemsPerPage}">ÌéòÏù¥ÏßÄÎãπ Ìï≠Î™© Ïàò:</label>
                        <select id="itemsPerPage" class="form-control" style="display:inline-block; width:auto;">
                            <option value="10">10Í∞ú</option>
                            <option value="20">20Í∞ú</option>
                            <option value="50">50Í∞ú</option>
                        </select>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>

            <!-- Ï±Ö Í≤ÄÏÉâ Í≤∞Í≥º ÏÑπÏÖò -->
            <div class="col-md-12">
                <form id="searchResultsForm">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th th:text="#{book.list.cover}">Ï±Ö ÌëúÏßÄ</th>
                            <th th:text="#{book.list.info}">Ï±Ö Ï†ïÎ≥¥</th>
                            <th th:text="#{book.list.rating}">Î≥ÑÏ†ê</th>
                            <th th:text="#{book.list.price}">Í∞ÄÍ≤©</th>
                            <th th:text="#{book.list.packaging}">Ìè¨Ïû• Ïó¨Î∂Ä</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="book : ${bookSearches.data}">
                            <td><img th:src="@{${book.image}}" alt="Ï±Ö ÏÇ¨ÏßÑ" style="width:100px;"></td>
                            <td>
                                <div class="book-info">
                                    <a class="book-title" th:href="@{/books/book/{id}(id=${book.id})}" th:text="${book.title}" >Ï±Ö Ï†úÎ™©</a>
                                    <div class="book-author-publisher">
                                        <span class="book-author" th:text="${book.author}">Ï†ÄÏûê</span><br>
                                        <span class="book-publisher" th:text="${book.publisher}">Ï∂úÌåêÏÇ¨</span>
                                    </div>
                                </div>
                            </td>
                            <td class="star-rating">
                                <span th:text="${book.score}">Î≥ÑÏ†ê</span>
                                <span class="fa fa-star" style="color:#ffd11a;"></span>
                            </td>
                            <td>
                                <div class="price-info">
                                    <span class="original-price" th:text="${book.price} + ' Ïõê'">ÌåêÎß§ Í∞ÄÍ≤©</span>
                                    <span class="discounted-price" th:text="${book.discountPrice} + ' Ïõê'">Ìï†Ïù∏ Í∞ÄÍ≤©</span>
                                </div>
                            </td>
                            <td>
                                <span style="font-size: 16px;" class="strong-text" th:if="${book.isPackaged}">Ìè¨Ïû• Í∞ÄÎä•</span>
                                <span style="font-size: 16px;" class="strong-text" th:if="${!book.isPackaged}">Ìè¨Ïû• Î∂àÍ∞Ä</span>
                            </td>
                            <td>
                                <div class="btn-group-vertical">
<!--                                    <a onclick="" class="btn btn-primary" th:text="#{book.list.addToCart}">Ïû•Î∞îÍµ¨ÎãàÏóê ÎÑ£Í∏∞</a>-->
                                    <a  th:attr="onclick='addToCart(' + ${book.id} + ', \'' + ${book.title} + '\', \'' + ${book.image} + '\', ' + ${book.price} + ', ' + ${book.discountPrice} + ', ' + ${book.isPackaged} + ')'"   th:text="#{book.list.addToCart}" class="btn btn-primary">Ïû•Î∞îÍµ¨ÎãàÏóê ÎÑ£Í∏∞</a>

                                    <a href="#" class="btn btn-success" th:text="#{book.list.buyNow}">Î∞îÎ°ú Íµ¨Îß§</a>
                                    <a th:href="@{/books/book/{id}(id=${book.id})}" class="btn btn-info" th:text="#{book.list.viewProduct}">ÏÉÅÌíà Î≥¥Í∏∞</a>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </form>

                <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
                <div class="pagination">
                    <!-- Ïù¥Ï†Ñ Î≤ÑÌäº -->
                    <li class="page-item" th:classappend="${bookSearches.pageNum == 0} ? 'disabled'">
                        <a th:if="${bookSearches.pageNum > 0}" th:href="@{${prevPageUrl}}" onclick="return false;" th:text="#{pagination.previous}">Previous</a>
                        <span th:if="${bookSearches.pageNum == 0}" th:text="#{pagination.previous}">Previous</span>
                    </li>

                    <!-- ÌéòÏù¥ÏßÄ Î≤àÌò∏ -->
                    <li class="page-item" th:if="${bookSearches.getTotalPageCount() > 0}" th:each="i : ${#numbers.sequence(0, bookSearches.getTotalPageCount() - 1)}">
                        <a th:href="@{${currentPageUrl}}" th:text="${i + 1}" th:classappend="${i == bookSearches.pageNum} ? 'active' : ''"></a>
                    </li>

                    <!-- Îã§Ïùå Î≤ÑÌäº -->
                    <li class="page-item" th:classappend="${bookSearches.pageNum >= bookSearches.getTotalPageCount() - 1} ? 'disabled'">
                        <a th:if="${bookSearches.pageNum < bookSearches.getTotalPageCount() - 1}" th:href="@{${nextPageUrl}}" onclick="return false;" th:text="#{pagination.next}">Next</a>
                        <span th:if="${bookSearches.pageNum >= bookSearches.getTotalPageCount() - 1}" th:text="#{pagination.next}">Next</span>
                    </li>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{layout/store/footer::footer}"></div>

<!-- Hidden Inputs -->
<input type="hidden" id="searchType" th:value="${searchType}">
<input type="hidden" id="keyword" th:value="${keyword}">
<input type="hidden" id="pageNum" th:value="${bookSearches.pageNum}">
<!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        var searchType = $('#searchType').val();
        var keyword = $('#keyword').val();
        var pageNum = $('#pageNum').val();

        var prevPageUrl = createPaginationLink(searchType, keyword, parseInt(pageNum) - 1);
        var nextPageUrl = createPaginationLink(searchType, keyword, parseInt(pageNum) + 1);
        var currentPageUrl = createPaginationLink(searchType, keyword, pageNum);


        // Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ ÎßÅÌÅ¨ ÏÑ§Ï†ï
        $('.pagination .page-item:first-child a').attr('href', prevPageUrl);

        // Îã§Ïùå ÌéòÏù¥ÏßÄ ÎßÅÌÅ¨ ÏÑ§Ï†ï
        $('.pagination .page-item:last-child a').attr('href', nextPageUrl);

        // Í∞Å ÌéòÏù¥ÏßÄ Î≤àÌò∏ ÎßÅÌÅ¨ ÏÑ§Ï†ï
        $('.pagination .page-item:not(:first-child):not(:last-child) a').each(function(index) {
            $(this).attr('href', createPaginationLink(searchType, keyword, index));

        });

        // Ï†ïÎ†¨ Í∏∞Ï§Ä ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        // $('#lowest_price').on('click', function() {
        //     var sortLink = createSortLink(searchType, keyword, 'discountPrice');
        //     window.location.href = sortLink;
        // });
        //
        // $('#highest_price').on('click', function() {
        //     var sortLink = createSortLink(searchType, keyword, 'discountPrice');
        //     window.location.href = sortLink;
        // });

        $('#lowest_price').on('click', function() {
            var sortLink = createSortLink(searchType, keyword, 'discountPrice');
            window.location.href = sortLink;
        });

        $('#rating').on('click', function() {
            var sortLink = createSortLink(searchType, keyword, 'score');
            window.location.href = sortLink;
        });

        $('#review').on('click', function() {
            var sortLink = createSortLink(searchType, keyword, 'review');
            window.location.href = sortLink;
        });



        // ÏÑ†ÌÉùÎêú Î™®Îì† Ï±Ö Ï≤¥ÌÅ¨Î∞ïÏä§
        $('#selectAll').on('click', function () {
            $('.bookCheckbox').prop('checked', this.checked);
        });

        // // ÏÑ†ÌÉùÎêú Ìï≠Î™© Ïû•Î∞îÍµ¨ÎãàÏóê ÎÑ£Í∏∞ Î∞è Î∞îÎ°ú Íµ¨Îß§
        // $('#searchResultsForm').on('submit', function (e) {
        //     e.preventDefault();
        //     // ÏÑ†ÌÉùÎêú Ï±Ö ÏïÑÏù¥ÌÖúÎì§Ïóê ÎåÄÌïú Ï≤òÎ¶¨ Î°úÏßÅÏùÑ Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî.
        //     alert('ÏÑ†ÌÉùÎêú Ìï≠Î™©Ïù¥ Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.');
        // });
    });


    function createSortLink(searchType, keyword, sortType) {
        if (searchType === 'category') {
            return '/search/category?category=' + keyword + '&sort=' + sortType;
        } else if (searchType === 'keyword') {
            return '/search/keyword?keyword=' + keyword + '&sort=' + sortType;
        } else {
            return '#';
        }
    }
    function createPaginationLink(searchType, keyword, pageNum) {
        if (searchType === 'category') {
            return '/search/category?category=' + keyword + '&page=' + pageNum;
        } else if (searchType === 'keyword') {
            return '/search/keyword?keyword=' + keyword + '&page=' + pageNum;
        } else {
            return '#';
        }
    }
    function addToCart(bookId, bookTitle, bookImage, bookPrice, bookDiscountPrice, bookIsPackaged) {

        axios.request({
            url: '/api/v1/front/carts',
            method: 'POST',
            data: JSON.stringify({
                bookId: bookId,
                title: bookTitle,
                image: bookImage,
                price: bookPrice,
                discountPrice: bookDiscountPrice,
                quantity: 1,
                isPackaged: bookIsPackaged,
                bookStatusId:1

            }),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            alert('Ïû•Î∞îÍµ¨ÎãàÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.');
        })
            .catch(error => {
                alert(error.response.data);
                console.error('Error cart add:', error.response.data);
            });
    }
</script>
</body>
</html>
