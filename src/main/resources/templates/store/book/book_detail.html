<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>NovaBookğŸ“•</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700|Raleway:400,300,500,700,600'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css"
          type="text/css">
    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"/>
</head>

<style>
    .disabled {
        pointer-events: none;
        opacity: 0.5;
    }

    .product-info-btn .fa-heart-o {
        color: #777; /* ê¸°ë³¸ í•˜íŠ¸ ì•„ì´ì½˜ ìƒ‰ìƒ */
    }

    .product-info-btn .fa-heart {
        color: red; /* ì¢‹ì•„ìš” ìƒíƒœì—ì„œ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½í•  ìƒ‰ìƒ */
    }

    .coupon-list {
        list-style: none;
        padding: 0;
    }

    .review-size {
        min-height: 50px;
    }

    .coupon-list li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #e5e5e5;
    }

    .coupon-download {
        background: none;
        border: none;
        font-size: 18px;
        color: #337ab7;
        cursor: pointer;
        padding: 0;
    }

    .coupon-download:hover {
        color: #23527c;
    }

    .modal-dialog {
        max-width: 800px; /* ì›í•˜ëŠ” ë„ˆë¹„ë¡œ ì¡°ì • */
    }

    .table th:nth-child(3), .table td:nth-child(3) {
        white-space: pre-line; /* ì¤„ ë°”ê¿ˆ í—ˆìš© */
    }
</style>


<body>

<div th:replace="~{layout/store/nav::nav}"></div>

<!-- íƒ€ì„ë¦¬í”„ ë³€ìˆ˜ ì •ì˜ -->
<div th:if="${book}">
    <input type="hidden" id="bookId" th:value="${book.id}">
    <input type="hidden" id="bookTitle" th:value="${book.title}">
    <input type="hidden" id="bookImage" th:value="${book.image}">
    <input type="hidden" id="bookPrice" th:value="${book.price}">
    <input type="hidden" id="bookDiscountPrice" th:value="${book.discountPrice}">
    <input type="hidden" id="bookIsPackaged" th:value="${book.isPackaged}">
    <input type="hidden" id="bookStatusId" th:value="${book.bookStatusId}">
</div>

<div class="breadcumbs">

    <div class="container">

        <div class="row">
            <span class="strong-text">ì¹´í…Œê³ ë¦¬:</span>
            <span th:each="category, iterStat : ${book.categories}">
                    <span th:text="${category}"></span>
                    <span th:if="${!iterStat.last}">> </span>
            </span>
        </div>
    </div>
</div>


<div class="short-description">

    <div class="container">

        <div class="row">

            <div class="col-md-6">

                <div class="product-thumbnail">

                    <div class="col-md-10 col-sm-10 col-xs-10">
                        <div><a href="">
                            <img class="thumb-main-image" th:src="${book.image}" alt=""></a>
                        </div>

                    </div>

                </div>

                <div class="clearfix"></div>

            </div>

            <div class="col-md-6">

                <h1 class="product-title" th:text="${book.title}">ë¦¬í‹€ ë¼ì´í”„ 1 </h1>


                <div class="ratings">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <span class="vote-count" th:text="${book.score}"> í‰ì  4.6 ì </span>

                    &nbsp;&nbsp;

                    <i class="fa fa-heart"></i>
                    <span class="vote-count" th:text="${book.likes}"> ì¢‹ì•„ìš” 35 ê°œ</span>
                </div>

                <div class="product-info">
                    <span class="product-id strong-text" th:text="${book.author}"><span>ì €ì:</span> í•œì•¼ ì•¼ë‚˜ê¸°í•˜ë¼</span>
                </div>
                <br>

                <p>
                    <span class="strong-text">ì¹´í…Œê³ ë¦¬:</span>
                    <span th:each="category, iterStat : ${book.categories}">
                    <span th:text="${category}"></span>
                    <span th:if="${!iterStat.last}">, </span>
                </span>
                </p>
                <p>
                    <span class="strong-text">íƒœê·¸:</span>
                    <span th:each="tag, iterStat : ${book.tags}">
                    <span th:text="${tag}"></span>
                    <span th:if="${!iterStat.last}">, </span>
                </span>
                </p>
                <p><span class="strong-text">ì„¤ëª…:</span> <span
                        th:text="${book.description}">í•œ ë‚¨ìì˜ ìŠ¬í”ˆ ì¸ìƒ ì—¬í–‰ê¸°! ìµœë‹¤ íŒë§¤ ë„ì„œ</span></p>
                <br><br>

                <hr>

                <p>
                    <span class="strong-text" style="font-size: 16px;">íŒë§¤ê°€:</span>
                    <span th:text="${#numbers.formatInteger(book.discountPrice, 1, 'COMMA')} + 'ì›'" class="price_real">12,600 ì›</span>
                    <span style="margin-left: 16px; font-size: 16px;" class="strong-text">ì •ê°€:</span>
                    <span th:text="${#numbers.formatInteger(book.price, 1, 'COMMA')} + 'ì›'" class="price_original">12,600 ì›</span>
                    <span style="margin-left: 16px; font-size: 16px;" class="strong-text">ì ë¦½ í¬ì¸íŠ¸:</span>
                    <span th:text="${#numbers.formatInteger(400, 1, 'COMMA')} + 'ì›'" class="price_point">400 ì›</span>
                    <span style="margin-left: 16px; font-size: 16px;" class="strong-text" th:if="${book.isPackaged}">í¬ì¥ ê°€ëŠ¥</span>
                    <span style="margin-left: 16px; font-size: 16px;" class="strong-text" th:if="${!book.isPackaged}">í¬ì¥ ë¶ˆê°€</span>
                </p>

                <form class="purchase-form">
                    <div class="qt-area">
                        <i class="fa fa-minus"></i>
                        <input id="bookQuantity" class="qt" value="1"
                               th:disabled="${book.bookStatusId == 2 or book.bookStatusId == 3}">
                        <i class="fa fa-plus"></i>
                    </div>
                    <button id="addCartButton" class="btn btn-theme" type="submit"
                            th:text="${book.bookStatusId == 2 ? 'ì¼ì‹œí’ˆì ˆ' : (book.bookStatusId == 3 ? 'í’ˆì ˆ' : 'Add to cart')}"
                            th:classappend="${book.bookStatusId == 2 or book.bookStatusId == 3} ? ' disabled' : ''"
                            th:onclick="${book.bookStatusId == 2 or book.bookStatusId == 3} ? '' : 'addCart()'">
                        Add to cart
                    </button>
                </form>

                <button class="btn product-info-btn" type="button" onclick="toggleLike()">
                    <i class="fa" th:classappend="${isLiked ? 'fa-heart' : 'fa-heart-o'}"
                       th:style="${isLiked ? 'color: red;' : ''}"></i> ì¢‹ì•„ìš”
                </button>
                <button type="button" class="btn btn-primary" style="color: white; background-color: #0e0e0e"
                        data-toggle="modal" data-target="#couponModal"
                        th:data-book-id="${book.id}">
                    ì¿ í° ë‹¤ìš´ë¡œë“œ
                </button>

            </div>

        </div>

    </div>

</div>

<!-- ì¿ í° ëª¨ë‹¬ ì‹œì‘ -->
<div class="modal fade" id="couponModal" tabindex="-1" role="dialog" aria-labelledby="couponModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="couponModalLabel">ì¿ í° ë‹¤ìš´ë¡œë“œ</h4>
            </div>
            <div class="modal-body">
                <ul class="coupon-list" id="bookCouponList">
                    <!-- ë„ì„œ ì¿ í° ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">ë‹«ê¸°</button>
                <!--                <button type="button" class="btn btn-primary">ì¿ í° ì ìš©</button>-->
            </div>
        </div>
    </div>
</div>
<!-- ì¿ í° ëª¨ë‹¬ ë -->


<div class="container">

    <div class="row">

        <div class="single-product-tabs">

            <ul class="nav nav-tabs nav-single-product-tabs">

                <li class="active"><a href="#description" data-toggle="tab">Description</a></li>

                <li><a href="#reviews" data-toggle="tab">Reviews</a></li>

            </ul>

            <div class="tab-content">

                <div class="tab-pane active" id="description">

                    <div class="product-desc">

                        <h2>ì±… ì„¤ëª…</h2>

                        <p th:text="${book.descriptionDetail}">
                            ì²œ í˜ì´ì§€ë¥¼ ì••ë„í•˜ëŠ” í­í’ ê°™ì€ ì„œì‚¬
                            2015ë…„ ë§¨ë¶€ì»¤ìƒ ìµœê³ ì˜ í™”ì œì‘

                            ì´ ì†Œì„¤ì„ ì†Œê°œí•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€, ë„ˆë¬´ë‚˜ í”í•œ ê´€ìš©êµ¬ëŒ€ë¡œ â€œê²°ì½” ì†ì—ì„œ ë†“ì„ ìˆ˜ ì—†ë‹¤â€ê³  ë§í•˜ëŠ” ê²ƒì´ë‹¤. ë…ìë¥¼ ë‘ë µê³  ë¶ˆí¸í•˜ê²Œ í•˜ë©´ì„œë„ ì‚¬ë¡œì¡ëŠ” ì†Œì„¤ì„ ë¬˜ì‚¬í• 
                            ë” ì ì ˆí•œ í‘œí˜„ì€ ì—†ë‹¤. _ì»¤ì»¤ìŠ¤ ë¬¸í•™ìƒ ì„ ì •ë‹¨

                            ì˜ë¯¸ê¶Œì„ ëŒ€í‘œí•˜ëŠ” ë¬¸í•™ìƒ ë§¨ë¶€ì»¤ìƒê³¼ ì „ë¯¸ë„ì„œìƒ ìµœì¢…í›„ë³´ì— ë‚˜ë€íˆ ì˜¤ë¥´ê³ , [ë‰´ìš•íƒ€ì„ìŠ¤] [ì›Œì‹±í„´í¬ìŠ¤íŠ¸] [ê°€ë””ì–¸] [ì›”ìŠ¤íŠ¸ë¦¬íŠ¸ì €ë„]ì„ ë¹„ë¡¯í•œ 25ê°œ ì–¸ë¡ ì‚¬ì—ì„œ
                            â€˜ì˜¬í•´ì˜ ì±…â€™ìœ¼ë¡œ ê¼½ì€ í™”ì œì‘ ã€Šë¦¬í‹€ ë¼ì´í”„ã€‹ê°€ í•œêµ­ì–´íŒìœ¼ë¡œ ì¶œê°„ë˜ì—ˆë‹¤. ì˜êµ­ê³¼ ë¯¸êµ­ì˜ ëŒ€í‘œ ë¬¸í•™ìƒ í›„ë³´ì— ì„ ì •ë˜ê¸° ì „ë¶€í„° ë…ìë“¤ ì‚¬ì´ì—ì„œëŠ” â€œë°¤ì„ ìƒˆì›Œ ì½ì—ˆë‹¤â€
                            â€œì²œ í˜ì´ì§€ê°€ ë” ê¸¸ì—ˆìœ¼ë©´ í•˜ëŠ” ì†Œì„¤ì€ ì²˜ìŒì´ë‹¤â€ â€œëˆˆë¬¼ì´ ë‚˜ ëª‡ ë²ˆì„ ì½ë‹¤ ë©ˆì¶°ì•¼ í–ˆë‹¤â€ â€œì¶©ê²©ì ì´ê³  ê°€ìŠ´ ì•„í”„ë‹¤â€ â€œì½ëŠ” ë‚´ë‚´ ë§¤ì¼ ë°¤ ì´ ì†Œì„¤ì— ê´€í•œ ê¿ˆì„
                            ê¿¨ë‹¤â€ ê°™ì€ ë¦¬ë·°ì™€ í•¨ê»˜ ì´ë¯¸ ì…ì†Œë¬¸ì´ í¼ì§„ ì‘í’ˆìœ¼ë¡œ, ë§¨ë¶€ì»¤ìƒ í›„ë³´ì‘ìœ¼ë¡œ ì„ ì •ëœ í›„ ì´ë¡€ì ìœ¼ë¡œ í™ˆí˜ì´ì§€ì— ì‘ì› ëŒ“ê¸€ì´ ë‹¬ë¦¬ë©° ë…ìë“¤ì˜ ì—´ë ¬í•œ ì§€ì§€ë¥¼ ë°›ì•˜ë‹¤. ì–´ë¦°
                            ì‹œì ˆ ë”ì°í•œ í•™ëŒ€ì™€ í­ë ¥ì˜ íŠ¸ë¼ìš°ë§ˆë¥¼ ê°„ì§í•œ ë¹„ë°€ìŠ¤ëŸ¬ìš´ ì¸ë¬¼ ì£¼ë“œì˜ ì´ì•¼ê¸°ë¥¼ ë‹´ì€ ã€Šë¦¬í‹€ ë¼ì´í”„ã€‹ëŠ” ë˜í•œ ê·¸ ì†Œì¬ì˜ ì„ ì •ì„±ê³¼ ê°€ì°¨ ì—†ìŒìœ¼ë¡œ ì‹¬ì‚¬ìœ„ì›ë“¤ ì‚¬ì´ì—ì„œ ê°€ì¥
                            ë…¼ìŸì ì¸ ì‘í’ˆì´ ë˜ê¸°ë„ í–ˆë‹¤.

                            í˜„ëŒ€ ì†Œì„¤ë¡œëŠ” ë“œë¬¼ê²Œ ìš”ì•½ë³¸ê³¼ í•´ì„¤ì„œê°€ ë“±ì¥í•˜ê³ , ì„œí‰ ì‚¬ì´íŠ¸ â€˜êµ¿ë¦¬ì¦ˆâ€™ì— 4ë§Œ ëª…ì´ ë„˜ëŠ” ë…ìë“¤ì´ ë³„ì  4ì  ì´ìƒì˜ í‰ì ì„ ë‚¨ê¸°ê³  ìˆìœ¼ë©°, ì˜í™” [ìºë¡¤]ì˜ ë°°ìš°
                            ë£¨ë‹ˆ ë§ˆë¼ê°€ ì¶”ì²œ ë„ì„œë¡œ ê¼½ëŠ” ë“±, ì¶œê°„ëœ ì§€ ì¼ ë…„ì´ ë„˜ì€ ì§€ê¸ˆë„ ì—¬ì „íˆ ë…ìë“¤ì˜ ê°€ìŠ´ì— í° ë°˜í–¥ì„ ì¼ìœ¼í‚¤ê³  ìˆë‹¤.</p>

                    </div>

                </div>

                <div class="tab-pane" id="reviews">
                    <!--                -->
                    <div class="container-fluid px-1 py-5 mx-auto">
                        <div class="row justify-content-center">
                            <div class="col-xl-7 col-lg-8 col-md-10 col-12 text-center mb-5" id="review-content">
                                <!-- Swiper Container -->
                                <div class="swiper-container">
                                    <!-- Swiper Wrapper -->
                                    <div class="swiper-wrapper">
                                        <!-- Thymeleaf ë°˜ë³µë¬¸ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ ìƒì„± -->
                                        <div class="swiper-slide" th:each="review : ${reviews.getReviewResponses()}">
                                            <div class="card" style="background-color: #E8E8E8FF">
                                                <div class="row d-flex">
                                                    <div class="d-flex flex-column">
                                                        <h3 class="mt-2 mb-0" th:text="${review.nickName}">Username</h3>
                                                        <div>
                                                            <p class="text-left">
                                                                <span class="text-muted"
                                                                      th:text="${review.score} + '.0'">4.0</span>
                                                                <span th:each="star, iterStat : ${#numbers.sequence(1, 5)}"
                                                                      class="fa fa-star"
                                                                      th:classappend="${iterStat.count <= review.score} ? 'star-active' : 'star-inactive'"></span>
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="ml-auto">
                                                        <p class="text-muted pt-5 pt-sm-3"
                                                           th:text="${review.createdAt}">Date</p>
                                                    </div>
                                                </div>
                                                <div class="row text-left">
                                                    <p class="content" th:text="${review.content}">Review Content</p>
                                                </div>
                                                <div class="row text-left">
                                                    <div th:if="${#lists.isEmpty(review.reviewImages) or review.reviewImages[0] == null}">
                                                        ì´ë¯¸ì§€ ì—†ìŒ
                                                    </div>
                                                    <div th:unless="${#lists.isEmpty(review.reviewImages) or review.reviewImages[0] == null}">
                                                        <img class="pic" th:each="image : ${review.reviewImages}"
                                                             th:src="${image}" th:attr="data-image-url=${image}"
                                                             onclick="openImage(this)">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Add Pagination if needed -->
                                    <div class="swiper-pagination"></div>
                                    <!-- Add Navigation buttons if needed -->
                                    <div class="swiper-button-next"></div>
                                    <div class="swiper-button-prev"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--                    -->
                </div>
            </div>

        </div>

    </div>

</div>

<div class="container">

    <div class="row">

        <div class="related-items">

            <ul class="nav nav-tabs nav-single-product-tabs">

                <li class="active"><a href="#related" data-toggle="tab">Related Products</a></li>

            </ul>

            <div class="tab-content">

                <div class="tab-pane active" id="related">

                    <div class="col-md-3 col-sm-4">

                        <div class="single-product">

                            <div class="product-block">

                                <img src="/images/product-1.jpeg" alt="" class="thumbnail">

                                <div class="product-description text-center">

                                    <p class="title">Date Tiffany Torchiere</p>

                                    <p class="price">$ 55.00</p>

                                </div>

                                <div class="product-hover">

                                    <ul>

                                        <li><a href=""><i class="fa fa-cart-arrow-down"></i></a></li>

                                        <li><a href=""><i class="fa fa-arrows-h"></i></a></li>

                                        <li><a href=""><i class="fa fa-heart-o"></i></a></li>

                                    </ul>

                                </div>

                            </div>

                        </div>

                    </div>

                    <div class="col-md-3 col-sm-4">

                        <div class="single-product">

                            <div class="product-block">

                                <img src="/images/product-2.jpeg" alt="" class="thumbnail">

                                <div class="product-description text-center">

                                    <p class="title">Date Tiffany Torchiere</p>

                                    <p class="price">$ 55.00</p>

                                </div>

                                <div class="product-hover">

                                    <ul>

                                        <li><a href=""><i class="fa fa-cart-arrow-down"></i></a></li>

                                        <li><a href=""><i class="fa fa-arrows-h"></i></a></li>

                                        <li><a href=""><i class="fa fa-heart-o"></i></a></li>

                                    </ul>

                                </div>

                            </div>

                        </div>

                    </div>

                    <div class="col-md-3 col-sm-4">

                        <div class="single-product">

                            <div class="product-block">

                                <img src="/images/product-3.jpeg" alt="" class="thumbnail">

                                <div class="product-description text-center">

                                    <p class="title">Date Tiffany Torchiere</p>

                                    <p class="price">$ 55.00</p>

                                </div>

                                <div class="product-hover">

                                    <ul>

                                        <li><a href=""><i class="fa fa-cart-arrow-down"></i></a></li>

                                        <li><a href=""><i class="fa fa-arrows-h"></i></a></li>

                                        <li><a href=""><i class="fa fa-heart-o"></i></a></li>

                                    </ul>

                                </div>

                            </div>

                        </div>

                    </div>

                    <div class="col-md-3 col-sm-4">

                        <div class="single-product">

                            <div class="product-block">

                                <img src="/images/product-4.jpeg" alt="" class="thumbnail">

                                <div class="product-description text-center">

                                    <p class="title">Date Tiffany Torchiere</p>

                                    <p class="price">$ 55.00</p>

                                </div>

                                <div class="product-hover">

                                    <ul>

                                        <li><a href=""><i class="fa fa-cart-arrow-down"></i></a></li>

                                        <li><a href=""><i class="fa fa-arrows-h"></i></a></li>

                                        <li><a href=""><i class="fa fa-heart-o"></i></a></li>

                                    </ul>

                                </div>

                            </div>

                        </div>

                    </div>

                </div>

            </div>

        </div>

    </div>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var swiper = new Swiper('.swiper-container', {
            slidesPerView: 1,
            spaceBetween: 30,
            loop: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        console.log("DOMContentLoaded");
        $('#couponModal').on('show.bs.modal', function (event) {
            console.log("function start");
            var button = $(event.relatedTarget); // ë²„íŠ¼ì„ í†µí•´ ì´ë²¤íŠ¸ë¥¼ íŠ¸ë¦¬ê±°
            var bookId = button.data('book-id'); // `data-book-id` ì†ì„±ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°

            // ë„ì„œ ì¿ í° ê°€ì ¸ì˜¤ê¸°
            axios.get(`http://localhost:8080/coupons/book/${bookId}`)
                .then(function (response) {
                    var bookCouponList = document.getElementById('bookCouponList');
                    bookCouponList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ì„ ë¹„ì›ë‹ˆë‹¤.

                    var table = document.createElement('table');
                    table.className = 'table table-striped text-center tc'; // ê°€ìš´ë° ì •ë ¬

                    var thead = document.createElement('thead');
                    var headerRow = document.createElement('tr');
                    headerRow.innerHTML = `
                    <th class="tc">ì¿ í°ëª…</th>
                    <th class="tc">í• ì¸ ê¸ˆì•¡</th>
                    <th class="tc">ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥ ê¸°ê°„</th>
                    <th class="tc">ì‚¬ìš© ê°€ëŠ¥ ê¸°ê°„</th>
                    <th class="tc">ë‹¤ìš´ë¡œë“œ</th>
                `;
                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    var tbody = document.createElement('tbody');

                    response.data.responseList.forEach(function (couponTemplate) {
                        var row = document.createElement('tr');

                        var couponNameCell = document.createElement('td');
                        couponNameCell.textContent = couponTemplate.name;

                        var discountInfoCell = document.createElement('td');
                        discountInfoCell.textContent = couponTemplate.discountAmount + (couponTemplate.discountType === 'PERCENT' ? '%' : 'ì›');

                        var validPeriodCell = document.createElement('td');
                        var startedAt = new Date(couponTemplate.startedAt).toLocaleString();
                        var expirationAt = new Date(couponTemplate.expirationAt).toLocaleString();
                        validPeriodCell.textContent = `${startedAt}\n~\n${expirationAt}`;

                        var usePeriodCell = document.createElement('td');
                        var days = Math.floor(couponTemplate.usePeriod / 24);
                        var hours = couponTemplate.usePeriod % 24;
                        usePeriodCell.textContent = `${days}ì¼ ${hours}ì‹œê°„`;

                        var downloadButtonCell = document.createElement('td');
                        var downloadButton = document.createElement('button');
                        downloadButton.className = 'coupon-download';
                        downloadButton.innerHTML = '<i class="fa fa-download"></i>';
                        downloadButton.onclick = function () {
                            downloadCoupon(couponTemplate.id, downloadButton);
                        };

                        downloadButtonCell.appendChild(downloadButton);

                        row.appendChild(couponNameCell);
                        row.appendChild(discountInfoCell);
                        row.appendChild(validPeriodCell);
                        row.appendChild(usePeriodCell);
                        row.appendChild(downloadButtonCell);

                        tbody.appendChild(row);
                    });

                    table.appendChild(tbody);
                    bookCouponList.appendChild(table);
                })
                .catch(function (error) {
                    console.error('Error fetching book coupons:', error);
                });
        });
    });

    function downloadCoupon(couponTemplateId, buttonElement) {
        axios.post('/coupons/download', {couponTemplateId: couponTemplateId})
            .then(function (response) {
                alert('ì¿ í°ì´ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                buttonElement.classList.add('disabled');
                buttonElement.disabled = true;
                buttonElement.style.color = 'gray';
                buttonElement.querySelector('.fa-download').style.color = 'gray';
            })
            .catch(function (error) {
                console.error('Error downloading coupon:', error);
            });
    }


    function toggleLike() {
        var bookId = document.getElementById('bookId').value;
        var icon = document.querySelector('.product-info-btn i.fa'); // ì•„ì´ì½˜ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.


        if (!bookId) {
            alert("ì±…ì˜ ì‹ë³„ìë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        axios.request({
            url: '/api/v1/front/books/likes/' + bookId,
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (response.data.isLiked) {
                console.log("ì¢‹ì•„ìš”")
                icon.classList.remove("fa-heart-o");
                icon.classList.add("fa-heart");
                icon.style.color = "red";
            } else {
                console.log("ì¢‹ì•„ìš” ì·¨ì†Œ")
                icon.classList.remove("fa-heart");
                icon.classList.add("fa-heart-o");
                icon.style.color = "";
            }
        })
            .catch(error => {
                alert(error.response.data);
                console.error('Error cart add:', error.response.data);
            });

    }

    // review
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize Swiper
        new Swiper('.swiper-container', {
            pagination: {
                el: '.swiper-pagination',
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
    });

    //review image
    function openImage(element) {
        var imageUrl = element.getAttribute('data-image-url');
        window.open(imageUrl);
    }


    function addCart() {
        var bookId = document.getElementById('bookId').value;
        var bookTitle = document.getElementById('bookTitle').value;
        var bookImage = document.getElementById('bookImage').value;
        var bookPrice = document.getElementById('bookPrice').value;
        var bookDiscountPrice = document.getElementById('bookDiscountPrice').value;
        var bookQuantity = document.getElementById('bookQuantity').value;
        var bookIsPackaged = document.getElementById('bookIsPackaged').value;
        var bookStatusId = document.getElementById('bookStatusId').value;


        axios.request({
            url: '/api/v1/front/carts',
            method: 'POST',
            data: JSON.stringify({
                bookId: bookId,
                title: bookTitle,
                image: bookImage,
                price: bookPrice,
                discountPrice: bookDiscountPrice,
                quantity: bookQuantity,
                isPackaged: bookIsPackaged,
                bookStatusId: bookStatusId
            }),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            alert('ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        })
            .catch(error => {
                alert(error.response.data);
                console.error('Error cart add:', error.response.data);
            });
    }


</script>

<div th:replace="~{layout/store/footer::footer}"></div>
</body>
</html>
