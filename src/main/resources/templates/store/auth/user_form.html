<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NovaBookğŸ“•</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700|Raleway:400,300,500,700,600'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css"
          type="text/css">
    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        .button-container {
            text-align: center;
            margin-top: 20px; /* ë²„íŠ¼ë“¤ ì‚¬ì´ ê°„ê²© ì¡°ì • */
        }

        .button-container .but3, .button-container .but4 {
            margin: 0 10px; /* ë²„íŠ¼ë“¤ ì‚¬ì´ ê°„ê²© ì¡°ì • */
        }
    </style>
</head>

<body>
<div th:replace="~{layout/store/nav::nav}"></div>

<div class="register-container">

    <form method="post" action="/users/user/form">
        <div class="container">
            <div class="insert">

                <table>
                    <caption><h2>íšŒì›ê°€ì… ì–‘ì‹</h2></caption>
                    <tr>
                        <td class="col1">ì´ë¦„</td>
                        <td class="col2"><input type="text" name="name" maxlength="5"></td>
                    </tr>
                    <tr>
                        <td class="col1">ì•„ì´ë””</td>
                        <td class="col2">
                            <input type="text" id="loginId" name="loginId" maxlength="20">
                            <input class='but1' type="button" value="ì¤‘ë³µí™•ì¸" onclick="checkDuplicateId()">
                            <span id="idMessage"></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="col1">ë¹„ë°€ë²ˆí˜¸</td>
                        <td class="col2">
                            <input type="password" id="loginPassword" name="loginPassword" maxlength="20">
                            <p>â€»ë¹„ë°€ë²ˆí˜¸ëŠ” <span class="num">ë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì(~!@#$%^&*)ì˜ ì¡°í•©
                                    10 ~ 16ìë¦¬</span>ë¡œ ì…ë ¥ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="col1">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</td>
                        <td class="col2">
                            <input type="password" id="loginPasswordConfirm" name="loginPasswordConfirm" maxlength="20">
                            <span id="passwordMessage"></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="col1">ì´ë©”ì¼</td>
                        <td class="col2">
                            <input type="text" name="email">
                            <span class="a">@</span>
                            <input type="text" id="emailDomain" name="emailDomain">
                            <select name="mailslc" onchange="updateEmail()">
                                <option value="self" selected>ì§ì ‘ì…ë ¥</option>
                                <option value="naver">naver.com</option>
                                <option value="gm">gmail.com</option>
                                <option value="da">daum.com</option>
                                <option value="yah">yahoo.com</option>
                            </select>
                            <input class='but2' type="button" value="ì´ë©”ì¼ ì¤‘ë³µí™•ì¸" onclick="">
                        </td>
                    </tr>
                    <tr>
                        <td class="col1">ìƒë…„ì›”ì¼</td>
                        <td class="col2">
                            <select id="birth_year" name="birthYear" onchange="updateDays()">
                                <option value="select" selected>ì„ íƒ</option>
                                <!-- 1900ë…„ë¶€í„° 2027ë…„ê¹Œì§€ì˜ ì˜µì…˜ ì¶”ê°€ -->
                                <option th:each="year : ${#numbers.sequence(1900, 2027)}" th:value="${year}" th:text="${year}"></option>
                            </select>
                            <span class="label">ë…„</span>

                            <select id="birth_month" name="birthMonth" onchange="updateDays()">
                                <option value="select" selected>ì„ íƒ</option>
                                <!-- 1ì›”ë¶€í„° 12ì›”ê¹Œì§€ì˜ ì˜µì…˜ ì¶”ê°€ -->
                                <option th:each="month : ${#numbers.sequence(1, 12)}" th:value="${month}" th:text="${month}"></option>
                            </select>
                            <span class="label">ì›”</span>

                            <select id="birth_day" name="birthDay">
                                <option value="select" selected>ì„ íƒ</option>
                                <!-- 1ì¼ë¶€í„° 31ì¼ê¹Œì§€ì˜ ì˜µì…˜ ì¶”ê°€ -->
                                <option th:each="day : ${#numbers.sequence(1, 31)}" th:value="${day}" th:text="${day}"></option>
                            </select>
                            <span class="label">ì¼</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="col1">ì£¼ì†Œ</td>
                        <td class="col2">
                            <input type="text" id="address_line1" name="address" required>
                        </td>
                    </tr>
                    <tr>
                        <td class="col1">ì—°ë½ì²˜</td>
                        <td class="col2">
                            <input type="text" id="phone" name="number" required>
                        </td>
                    </tr>
                </table>

            </div>

            <div class="button-container">
                <button type="submit" class="but4" onclick="formCheck(this.form)">íšŒì›ê°€ì…</button>
                <input class="but3" type="button" value="ê°€ì…ì·¨ì†Œ" onclick="">
            </div>
        </div>
    </form>
</div>

<div th:replace="~{layout/store/footer::footer}"></div>
<script th:inline="javascript">
    /*<![CDATA[*/
    function updateDays() {
        var year = parseInt($('#birth_year').val());
        var month = parseInt($('#birth_month').val());
        var daySelect = $('#birth_day');

        daySelect.empty().append('<option value="select" selected>ì„ íƒ</option>');
        var daysInMonth = new Date(year, month, 0).getDate();

        var today = new Date();
        var currentYear = today.getFullYear();
        var currentMonth = today.getMonth() + 1; // getMonth()ëŠ” 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1 í•´ì¤Œ
        var currentDay = today.getDate();

        for (var day = 1; day <= daysInMonth; day++) {
            if (year < currentYear ||
                (year === currentYear && month < currentMonth) ||
                (year === currentYear && month === currentMonth && day <= currentDay)) {
                daySelect.append($('<option></option>').attr('value', day).text(day));
            }
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    $(document).ready(function() {
        updateDays();
    });

    // formCheck í•¨ìˆ˜ ì •ì˜
    function formCheck(form) {
        // ì´ë¦„ í•„ë“œ ê²€ì¦
        if (form.name.value.trim() === "") {
            alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.name.focus();
            return false; // í¼ ì œì¶œ ë°©ì§€
        }

        // ì•„ì´ë”” í•„ë“œ ê²€ì¦
        if (form.loginId.value.trim() === "") {
            alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.loginId.focus();
            return false; // í¼ ì œì¶œ ë°©ì§€
        }

        // ë¹„ë°€ë²ˆí˜¸ í•„ë“œ ê²€ì¦
        if (form.loginPassword.value === "") {
            alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.loginPassword.focus();
            return false; // í¼ ì œì¶œ ë°©ì§€
        }

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í•„ë“œ ê²€ì¦
        if (form.loginPasswordConfirm.value === "") {
            alert("ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.loginPasswordConfirm.focus();
            return false; // í¼ ì œì¶œ ë°©ì§€
        }

        // ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜ ì—¬ë¶€ ê²€ì¦
        if (form.loginPassword.value !== form.loginPasswordConfirm.value) {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            form.loginPassword.focus();
            return false; // í¼ ì œì¶œ ë°©ì§€
        }

        // ì´ë©”ì¼ í•„ë“œ ê²€ì¦ (ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹Œ ê²½ìš°ì— ëŒ€í•œ ì˜ˆì‹œ)
        var emailValue = form.email.value.trim();
        if (emailValue === "" || !isValidEmail(emailValue)) {
            alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.email.focus();
            return false; // í¼ ì œì¶œ ë°©ì§€
        }

        // ìƒë…„ì›”ì¼ í•„ë“œ ê²€ì¦
        if (form.birth_year.value === "select" || form.birth_month.value === "select" || form.birth_day.value === "select") {
            alert("ìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
            form.birth_year.focus();
            return false; // í¼ ì œì¶œ ë°©ì§€
        }

        // ì£¼ì†Œ í•„ë“œ ê²€ì¦
        if (form.address.value.trim() === "") {
            alert("ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.address.focus();
            return false; // í¼ ì œì¶œ ë°©ì§€
        }

        // ì—°ë½ì²˜ í•„ë“œ ê²€ì¦
        if (form.phone.value.trim() === "") {
            alert("ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.phone.focus();
            return false; // í¼ ì œì¶œ ë°©ì§€
        }

        // ëª¨ë“  ê²€ì¦ì„ í†µê³¼í–ˆì„ ë•Œ í¼ ì œì¶œ ê°€ëŠ¥
        return true;
    }

    // ì´ë©”ì¼ ë„ë©”ì¸ ìë™ ì™„ì„± í•¨ìˆ˜
    function updateEmail() {
        var domain = document.getElementsByName("mailslc")[0].value;
        var emailDomainInput = document.getElementById("emailDomain");

        switch (domain) {
            case "self":
                emailDomainInput.value = "";
                break;
            case "naver":
                emailDomainInput.value = "naver.com";
                break;
            case "gm":
                emailDomainInput.value = "gmail.com";
                break;
            case "da":
                emailDomainInput.value = "daum.net";
                break;
            case "yah":
                emailDomainInput.value = "yahoo.com";
                break;
            default:
                emailDomainInput.value = "";
                break;
        }
    }


    // ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ í•¨ìˆ˜
    function checkDuplicateId() {
        var loginId = document.getElementById('loginId').value.trim(); // ì•„ì´ë”” í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸°

        // ì„œë²„ API í˜¸ì¶œí•˜ì—¬ ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ë¡œì§ ì¶”ê°€ (ê°€ì •)
        var isDuplicate = checkIdFromServer(loginId); // ì„œë²„ì—ì„œ ì¤‘ë³µ ì—¬ë¶€ í™•ì¸ (ê°€ì •)

        // ì¤‘ë³µ ì—¬ë¶€ì— ë”°ë¼ ë©”ì‹œì§€ ì¶œë ¥
        var messageElement = document.getElementById('idMessage');
        if (isDuplicate) {
            messageElement.innerText = "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.";
        } else {
            messageElement.innerText = "ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.";
        }
    }

    // ì„œë²„ì—ì„œ ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ í•¨ìˆ˜ (ê°€ì •)
    function checkIdFromServer(loginId) {
        // ì—¬ê¸°ì— ì‹¤ì œ ì„œë²„ë¡œì˜ ìš”ì²­ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        // ê°€ì • ìƒìœ¼ë¡œëŠ” ê°„ë‹¨í•œ ëœë¤ ì²˜ë¦¬ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
        return Math.random() < 0.5; // ëœë¤í•˜ê²Œ true ë˜ëŠ” false ë°˜í™˜
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    $(document).ready(function() {
        updateDays();
    });
    /*]]>*/
</script>
</body>
</html>
