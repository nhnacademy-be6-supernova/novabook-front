<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NovaBookğŸ“•</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700|Raleway:400,300,500,700,600'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css"
          type="text/css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <script src="https://js.tosspayments.com/v1/payment"></script>
    <script src="https://js.tosspayments.com/v1/payment-widget"></script>
    <script src="/js/order_form.js"></script>
    <style>
        .form-inline .form-group {
            display: flex;
            align-items: center;
        }

        .form-inline .form-group input[type="text"] {
            flex: 1;
        }

        .delivery-date-container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .delivery-date-header {
            margin-bottom: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
            background-color: #f5f5f5;
        }

        .delivery-date-row {
            display: flex;
            justify-content: space-between;
            background-color: #f5f5f5;
        }

        .delivery-date-btn {
            flex: 1;
            text-align: center;
            border: 1px solid #ddd;
            padding: 10px;
            cursor: pointer;
            margin-right: 5px;
            background-color: #fff;
        }

        .delivery-date-btn.selected {
            background-color: #337ab7;
            color: white;
        }

        #payment-button {
            color: #87CEFA;
        }

        .delivery-date-btn:last-child {
            margin-right: 0;
        }

        .btn-center {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .payment-info {
            margin-top: 20px;
        }

        .payment-info-table {
            width: 100%;
            margin-top: 20px;
        }

        .payment-info-table th, .payment-info-table td {
            text-align: center;
            padding: 10px;
        }

        .payment-info-table .total {
            font-size: 1.5em;
            color: #d9534f;
        }

        .form-group-inline {
            display: inline-block;
            margin-right: 10px;
        }

        .full-width {
            width: 100%;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .section-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
        }

        .section {
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff;
            border: 0; /* ë³´ë”ê°’ì„ 0ìœ¼ë¡œ ì„¤ì • */
        }

        .image-cell img {
            max-width: 100%;
            max-height: 100px;
            width: auto;
            height: auto;
            display: block;
            margin: auto;
        }

        .image-cell {
            width: 110px; /* tdì˜ ë„ˆë¹„ë¥¼ ì •í•´ì¤ë‹ˆë‹¤ */
            height: 110px; /* tdì˜ ë†’ì´ë¥¼ ì •í•´ì¤ë‹ˆë‹¤ */
        }

        .total-price {
            background-color: #dfecf8;
            color: #892a51; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            font-weight: bold; /* í…ìŠ¤íŠ¸ êµµê²Œ */
            padding: 10px; /* íŒ¨ë”© ì¶”ê°€ */
            border-radius: 5px; /* í…Œë‘ë¦¬ ë°˜ê²½ */
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th, .table td {
            margin: 0 auto;
            vertical-align: middle; /* ìˆ˜ì§ ì •ë ¬ */
            text-align: center; /* ê¸°ë³¸ ìˆ˜í‰ ì •ë ¬ì„ ì¤‘ì•™ìœ¼ë¡œ ì„¤ì • */
            border: 1px solid #dee2e6;
            padding: 8px;
        }

        .table th {
            background-color: #f2f2f2;
        }

        .align-center {
            bottom: 100px;
            justify-content: center; /* ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
            align-items: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
            height: 100%; /* ë¶€ëª¨ ìš”ì†Œì˜ ë†’ì´ì— ë§ì¶”ê¸° */

        }
    </style>
</head>

<body>
<div th:replace="~{layout/store/nav::nav}"></div>
<div class="layout">

    <div class="container">
        <h1>ì£¼ë¬¸ í™•ì¸</h1>
        <form th:action="@{/order/success}" method="post">
            <!-- ì£¼ë¬¸ ìš”ì•½ -->
            <div class="section">
                <h2 class="section-header">ì£¼ë¬¸ ìš”ì•½</h2>
                <table id="orderTable" class="table">
                    <thead>
                    <tr>
                        <th>ì´ë¯¸ì§€</th>
                        <th>ìƒí’ˆëª…</th>
                        <th>ì›ê°€</th>
                        <th>ìˆ˜ëŸ‰</th>
                        <th>íŒë§¤ê°€</th>
                        <th>í•©ê³„</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="item, iterStat : ${items}" class="item-row" data-item-id="${item.id()}"
                        data-item-quantity="${item.quantity}">
                        <input type="hidden" name="itemId" th:id="${item.id()}" th:value="${item.id()}" class="item-id">
                        <td class="image-cell"><img th:src="@{${item.imageUrl()}}" alt="Product Image"></td>
                        <td th:text="${item.name}">Product Name</td>
                        <td th:text="${item.price} + 'ì›'">14,800ì›</td>
                        <td name="itemQuantity" th:text="${item.quantity}" class="item-quantity">1</td>
                        <td th:text="${item.discount()} + 'ì›'">íŒë§¤ê°€</td>
                        <td class="total-price align-center" name="totalPrice" th:text="${item.discount() * item.quantity()}" >ì´ê°€ê²©
                        </td>
                    </tr>
                    <tr th:if="${items == null || #lists.isEmpty(items)}">
                        <td colspan="6">ì£¼ë¬¸í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- í¬ì¥ ì˜µì…˜ -->
            <div class="section">
                <h2 class="section-header">í¬ì¥ ì˜µì…˜</h2>
                <select name="packaging" id="wrap_paper" class="form-control" onchange="updatePackagingPrice(this)">
                    <option th:value="0" selected>í¬ì¥ ì•ˆí•¨</option>
                    <option th:each="wrap : ${orderDTO.wrappingPapers()}" th:value="${wrap.id()}"
                            th:text="${wrap.name()}" data-price="1000">ì¼ë°˜ í¬ì¥
                    </option>
                </select>
            </div>

            <!-- ì¿ í° ì ìš© -->
            <div class="section">
                <h2 class="section-header">ì¿ í° ì ìš©</h2>
                <div class="form-group form-group-inline">
                    <input type="text" name="coupon" id="selectedCouponName" class="form-control" placeholder="ì¿ í° ì‚¬ìš©"
                           readonly/>
                    <input type="hidden" name="couponId" id="selectedCouponId"/>
                </div>
                <button type="button" class="btn btn-primary" onclick="openCoupon()">ì¿ í° ì ìš©</button>
            </div>

            <!-- í¬ì¸íŠ¸ ì‚¬ìš© -->
            <div class="section">
                <h2 class="section-header">í¬ì¸íŠ¸ ì‚¬ìš©</h2>
                <div class="form-group full-width">
                    <label for="currentPoints">í˜„ì¬ í¬ì¸íŠ¸: </label>
                    <span id="currentPoints" style="margin-left: 10px;" th:text="${orderDTO.myPoint()}">5,000í¬ì¸íŠ¸</span>
                </div>
                <div class="form-group full-width" style="display: flex; align-items: center;">
                    <input type="text" name="points" id="pointsInput" class="form-control" style="width: 20%;"
                           placeholder="ì‚¬ìš©í•  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"/>
                    <button type="button" class="btn btn-primary" style="margin-left: 10px;" onclick="applyPoints()">í¬ì¸íŠ¸ ì ìš©</button>
                </div>
            </div>

            <!-- ë°°ì†¡ì¼ ì„ íƒ -->
            <div class="section delivery-date-container">
                <h4 class="delivery-date-header">ë°°ì†¡ì¼ ì„ íƒ (ë„ì°© ì˜ˆìƒì¼)</h4>
                <div class="delivery-date-row">
                    <div th:each="date : ${dates}"
                         th:classappend="${#lists.isEmpty(dates)} ? ' selected' : ''"
                         th:text="${date}"
                         th:data-date="${date}"
                         class="delivery-date-btn"
                         onclick="selectDeliveryDate(this)"></div>
                </div>
            </div>

            <!-- ë°°ì†¡ì§€ ì •ë³´ -->
            <div class="section">
                <h2 class="section-header">ë³´ë‚´ëŠ” ì‚¬ëŒ ì •ë³´</h2>
                <div class="form-group full-width">
                    <label for="sender_name">ì´ë¦„</label>
                    <input type="text" id="sender_name" name="name" class="form-control" style="width: 70%;"
                           placeholder="ì´ë¦„"/>
                </div>

                <div class="form-group full-width" style="align-items: center;">
                    <div class="form-group full-width">
                        <label for="sender_phone">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" id="sender_phone" name="phone" class="form-control" style="width: 70%;"
                               placeholder="ì „í™”ë²ˆí˜¸"/>
                    </div>
                </div>
            </div>

            <div class="section">
                <!--   ë°›ëŠ” ì‚¬ëŒ        -->
                <h2 class="section-header">ë°›ëŠ” ì‚¬ëŒ ì •ë³´ <input type="button" class="btn btn-primary"
                                                           onclick="openMyaddress()" value="ë‚´ ì£¼ì†Œ"
                                                           style="margin-left: 10px;"></h2> <br>
                <div class="form-group full-width">
                    <label for="receiver_name">ì´ë¦„</label>
                    <input type="text" id="receiver_name" name="name" class="form-control" style="width: 20%;"
                           placeholder="ì´ë¦„"/>
                </div>

                <div class="form-group full-width" style="align-items: center;">
                    <div style="display: flex; width: 20%; margin-bottom: 10px;">
                        <input type="text" id="sample6_postcode" class="form-control" name="address" placeholder="ìš°í¸ë²ˆí˜¸"
                               required>
                        <input type="button" class="btn" value="ìš°í¸ë²ˆí˜¸ ì°¾ê¸°" onclick="sample6_execDaumPostcode()"> <br>
                    </div>

                    <div style="display: flex; width: 70%; margin-bottom: 10px;">
                        <input type="text" id="sample6_address" class="form-control" placeholder="ì£¼ì†Œ"><br>
                    </div>
                    <div style="display: flex; width: 70%; margin-bottom: 10px;">
                        <input type="text" id="sample6_detailAddress" class="form-control" placeholder="ìƒì„¸ì£¼ì†Œ">
                        <input type="text" class="form-control" id="sample6_extraAddress" placeholder="ì°¸ê³ í•­ëª©">
                    </div>
                    <div class="form-group full-width">
                        <label for="receiver_phone">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" id="receiver_phone" name="phone" class="form-control" style="width: 70%;"
                                placeholder="ì „í™”ë²ˆí˜¸"/>
                    </div>
                    <div class="form-group full-width">
                        <label for="receiver_email">ì´ë©”ì¼</label>
                        <input type="email" id="receiver_email" name="email" class="form-control" style="width: 70%;"
                                placeholder="ì´ë©”ì¼"/>
                    </div>
                </div>

                <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

                <!-- ê²°ì œ ì •ë³´ -->
                <div class="section payment-info">
                    <h2 class="section-header" style="border-bottom: 0; margin-bottom: 0;">ê²°ì œ ì •ë³´</h2>
                    <div class="table-responsive">
                        <table class="table payment-info-table">
                            <thead>
                            <tr>
                                <th>ì´ ìƒí’ˆê¸ˆì•¡</th>
                                <th>ì´ ì¶”ê°€ê¸ˆì•¡</th>
                                <th>ì´ í• ì¸ê¸ˆì•¡</th>
                                <th>ì´ í¬ì¸íŠ¸ ì‚¬ìš©</th>
                                <th>ë°°ì†¡ë¹„</th>
                                <th>ìµœì¢… ê²°ì œê¸ˆì•¡</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td id="totalAmount">0ì›</td>
                                <td id="additionalAmount">0ì›</td>
                                <td id="discountAmount">0ì›</td>
                                <td id="pointsUsed">0ì›</td>
                                <td id="shippingFee">2,500ì›</td> <!-- ì¶”ê°€ëœ ë°°ì†¡ë¹„ ë¶€ë¶„ -->
                                <td class="total" id="finalAmount">0ì›</td> <!-- ìµœì¢… ê²°ì œê¸ˆì•¡ì— ë°°ì†¡ë¹„ë¥¼ ë°˜ì˜ -->
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


                <!-- ê²°ì œ ë°©ë²• ì„ íƒ -->
                <div class="section">
                    <h2 class="section-header">ê²°ì œ ë°©ë²•</h2>
                    <div class="payment-method-buttons">
                        <button type="button" class="btn btn-primary" onclick="selectPaymentMethod('creditCard')">ì‹ ìš©ì¹´ë“œ
                        </button>
                        <button type="button" class="btn btn-success" onclick="selectPaymentMethod('naverPay')">ë„¤ì´ë²„í˜ì´
                        </button>
                        <button type="button" class="btn btn-info" id="toss_button" onclick='processPayment()'>í† ìŠ¤í˜ì´
                        </button>
                        <button type="button" class="btn btn-warning" onclick="selectPaymentMethod('payco')">í˜ì´ì½”
                        </button>
                    </div>
                </div>


                <!-- ê²°ì œ ì„œë¹„ìŠ¤ ì•½ê´€ ë™ì˜ -->
                <div class="section terms-conditions">
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" name="agreeServiceTerms" required> ê²°ì œ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤.
                        </label>
                    </div>
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" name="agreePrivacyPolicy" required> ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•©ë‹ˆë‹¤.
                        </label>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ì¿ í° ëª¨ë‹¬ -->
<div id="couponModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <!-- ëª¨ë‹¬ í—¤ë” -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">ì¿ í° ëª©ë¡</h4>
            </div>
            <!-- ëª¨ë‹¬ ë°”ë”” -->
            <div class="modal-body">
                <!-- ì¿ í° í…Œì´ë¸” -->
                <table class="table table-striped"> <!-- Bootstrap í…Œì´ë¸” í´ë˜ìŠ¤ ì¶”ê°€ -->
                    <caption class="hidden">ì¿ í°ë‚´ì—­</caption>
                    <colgroup>
                        <col style="width:5%;">
                        <col style="width:25%;">
                        <col style="width:10%;">
                        <col style="width:10%;">
                        <col style="width:10%;">
                        <col style="width:10%;">
                        <col style="width:10%;">
                        <col style="width:10%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th scope="col">ë²ˆí˜¸</th>
                        <th scope="col">ì¿ í°ëª…</th>
                        <th scope="col">ì¿ í°íƒ€ì…</th>
                        <th scope="col">í• ì¸ê¸ˆì•¡</th>
                        <th scope="col">ìµœëŒ€í• ì¸ê¸ˆì•¡</th>
                        <th scope="col">ìµœì†Œí• ì¸ê¸ˆì•¡</th>
                        <th scope="col">ë§Œë£Œì¼</th>
                        <th scope="col">ë²„íŠ¼</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="coupon , iterStat  : ${orderDTO.coupons()} ">
                        <td th:text="${iterStat.index + 1}">1</td> <!-- ì¸ë±ìŠ¤ ì¶”ê°€ -->
                        <td class="tal" th:text="${coupon.name()}">í–‰ë³µ ì¿ í°</td>
                        <td th:text="${coupon.type()}">2024-07-12</td>
                        <td th:text="${coupon.discountType().name() eq 'PERCENT' ? coupon.discountAmount() + '%' : coupon.discountAmount() + 'ì›'}">
                            30%
                        </td>
                        <td th:text="${coupon.maxDiscountAmount()} + 'ì›'">5000ì›</td>
                        <td th:text="${coupon.minPurchaseAmount()} + 'ì›'">5000ì›</td>
                        <td th:text="${#temporals.format(coupon.expirationAt(), 'yyyyë…„ Mì›” dì¼ a hì‹œê¹Œì§€').replace('AM', 'ì˜¤ì „').replace('PM', 'ì˜¤í›„')}">
                            2024ë…„ 7ì›” 2ì¼ 6ì‹œê¹Œì§€
                        </td>
                        <td>
                            <button
                                    type="button"
                                    class="btn btn-primary"
                                    th:attr="data-id=${coupon.id}, data-name=${coupon.name}, data-discount=${coupon.discountType().name() eq 'PERCENT' ? coupon.discountAmount() + '%' : coupon.discountAmount() + 'ì›'}"
                                    onclick="selectCoupon(this)">ì„ íƒ
                            </button>
                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>
            <!-- ëª¨ë‹¬ í’‹í„° -->
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>


<!-- ì£¼ì†Œì§€ ëª¨ë‹¬ -->
<div id="myAddressModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg"> <!-- ëª¨ë‹¬ ì°½ í¬ê¸°ë¥¼ largeë¡œ ì„¤ì • -->
        <div class="modal-content">
            <!-- ëª¨ë‹¬ í—¤ë” -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">ë‚´ ì£¼ì†Œì§€</h4>
            </div>
            <!-- ëª¨ë‹¬ ë°”ë”” -->
            <div class="modal-body">
                <!-- ì¿ í° í…Œì´ë¸” -->
                <table class="table table-striped"> <!-- Bootstrap í…Œì´ë¸” í´ë˜ìŠ¤ ì¶”ê°€ -->
                    <caption class="hidden">ì¿ í°ë‚´ì—­</caption>
                    <colgroup>
                        <col style="width:8%;">
                        <col style="width:10%;">
                        <col style="width:70%;">
                        <col style="width:10%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th scope="col">ë²ˆí˜¸</th>
                        <th scope="col">ë³„ì¹­</th>
                        <th scope="col">ìƒì„¸ì£¼ì†Œ</th>
                        <th scope="col">ì„ íƒ</th> <!-- ì„ íƒ ë²„íŠ¼ ì—´ ì¶”ê°€ -->
                    </tr>
                    </thead>
                    <tbody>
                    <!-- ë°˜ë³µêµ¬ë¬¸ ì‹œì‘ -->
                    <tr th:each="address, iterStat : ${orderDTO.memberAddresses()}">
                        <td th:text="${iterStat.index + 1}">1</td> <!-- ì¸ë±ìŠ¤ ì¶”ê°€ -->
                        <td th:text="${address.memberAddressDetail()}">30%</td>
                        <td th:text="${address.streetAddress() + ' ' + address.memberAddressDetail()}">5000ì›</td>
                        <td>
                            <button type="button" class="btn btn-primary"
                                    th:attr="data-street-address=${address.streetAddress()}, data-detail-address=${address.memberAddressDetail()}, data-zipcode=${address.zipcode()}"
                                    onclick="selectAddress(this)">ì„ íƒ
                            </button>
                        </td>
                    </tr>

                    <!-- ë°˜ë³µêµ¬ë¬¸ ë -->
                    </tbody>
                </table>
            </div>
            <!-- ëª¨ë‹¬ í’‹í„° -->
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</div>
<div th:replace="~{layout/store/footer::footer}"></div>
</body>
</html>
